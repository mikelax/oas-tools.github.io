(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[547],{3454:function(e,t,n){"use strict";var s,i;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"===typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(7663)},183:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/features/validation",function(){return n(1722)}])},4774:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var s=n(5893),i={src:"/_next/static/media/isa.5e2e4cad.svg",height:424,width:923},o=n(5675),r=n.n(o),a=function(e){var t=e.height,n=void 0===t?30:t;return(0,s.jsx)(r(),{className:"isalogo",src:i,height:n,width:70})};function l(e){var t=e.locale;return"es-ES"===(void 0===t?"en-US":t)?(0,s.jsxs)("a",{href:"https://isa.us.es",target:"_blank",rel:"noopener",className:"inline-flex items-center no-underline text-current font-semibold",children:[(0,s.jsx)("span",{className:"mr-2",style:{height:30},children:"Desarrollado por"}),(0,s.jsx)("span",{className:"mr-2",children:(0,s.jsx)(a,{})})]}):(0,s.jsxs)("a",{href:"https://isa.us.es",target:"_blank",rel:"noopener",className:"inline-flex items-center no-underline text-current font-semibold",children:[(0,s.jsx)("span",{className:"mr-2",style:{height:30},children:"Powered by"}),(0,s.jsx)("span",{className:"mr-2",children:(0,s.jsx)(a,{})})]})}},4177:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var s=n(5893),i={src:"/_next/static/media/oaslogo.34d328ed.png",height:1155,width:1170,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABCklEQVR42mMAgfKvDArZV7iKcq4x12aellVlAAIHB4fZDnaO4QyGDF4qYdONwnPvMPzJvsb8iwEIbNWd7B2cHG4DcTaDk5NTrI2s8/+QqYanCu4zrHCLcPCyNXA8qcjgJsIAAq4xdtX2No6vLRlcVlszuJbamzg9CW910p32n4E345SMDkPyPsWMrEucd3KuM6x1CrC19EyxL82/w3Yx5yrX95zrHLkM+XcYEnKuMf7Pu8Pw06fSYqWjh8OWnJsMT4Aa/udc44lgyDwnJJZ7kyE78zzvZVtdp5c2Mk7/QyYbHSh8zBCceUZSigEEsi7yyha/ZDCx5nCe6ujsMNXB3tHHzc+Zm4GBgQEAIZZaQkv0A+oAAAAASUVORK5CYII="},o=n(5675),r=n.n(o);function a(e){var t=e.size,n=void 0===t?35:t;return(0,s.jsx)(r(),{className:"oaslogo",src:i,height:n,width:n})}},8756:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var s=n(4924),i=n(5893),o=n(7294),r=n(7273);function a(e){var t=(0,o.useState)(""),n=t[0],a=t[1];return(0,o.useEffect)((function(){r.Z.initialize((0,s.Z)({startOnLoad:!0,theme:"default",securityLevel:"loose"},"theme","dark")),r.Z.render("diagram-".concat(e.id),String(e.children.props.children).replace(/\\n/g,"<br/>"),(function(e){return a(e)}))}),[]),(0,i.jsx)("div",{id:e.id,className:"mermaid",style:{display:"flex",justifyContent:"center",userSelect:"none",marginTop:"1.5rem"},dangerouslySetInnerHTML:{__html:n}})}},7845:function(e,t,n){"use strict";var s=n(5893),i=n(1163),o=n(4774),r=n(4177),a={"en-US":"Question? Give us feedback \u2192","es-ES":"Ap\xf3rtanos feedback \u2192"};t.Z={projectLink:"https://github.com/oas-tools",docsRepositoryBase:"https://github.com/oas-tools/oas-tools.github.io/blob/main/pages",titleSuffix:" \u2013 OAS Tools",search:!0,unstable_flexsearch:!0,defaultMenuCollapsed:!0,floatTOC:!0,nextLinks:!0,prevLinks:!0,darkMode:!0,footer:!0,footerEditLink:function(e){return"es-ES"===e.locale?"Edite esta p\xe1gina en GitHub \u2192":"Edit this page on GitHub \u2192"},feedbackLabels:"feedback",feedbackLink:function(){var e=(0,i.useRouter)().locale;return a[e]||a["en-US"]},footerText:function(e){return(0,o.Z)(e)},logo:function(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Z,{size:35}),(0,s.jsx)("span",{className:"mx-4 font-extrabold hidden md:inline select-none",title:"OAS Tools: A NodeJS OpenAPI Framework",children:"OAS TOOLS"}),(0,s.jsx)("span",{className:"text-gray-500 font-normal hidden md:inline",children:"A NodeJS OpenAPI framework"})]})},head:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/favicon/apple-touch-icon.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/favicon/favicon-32x32.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/favicon/favicon-16x16.png"}),(0,s.jsx)("link",{rel:"manifest",href:"/favicon/site.webmanifest"}),(0,s.jsx)("link",{rel:"mask-icon",href:"/favicon/safari-pinned-tab.svg",color:"#5bbad5"}),(0,s.jsx)("link",{rel:"shortcut icon",href:"/favicon/favicon.ico"}),(0,s.jsx)("meta",{name:"msapplication-TileColor",content:"#ffffff"}),(0,s.jsx)("meta",{name:"msapplication-config",content:"/favicon/browserconfig.xml"}),(0,s.jsx)("meta",{name:"theme-color",content:"#ffffff"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,s.jsx)("meta",{httpEquiv:"Content-Language",content:"en"}),(0,s.jsx)("meta",{name:"description",content:"OAS Tools: A NodeJS OpenAPI framework"}),(0,s.jsx)("meta",{name:"og:description",content:"OAS Tools: A NodeJS OpenAPI framework"}),(0,s.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,s.jsx)("meta",{name:"twitter:image",content:"https://oas-tools.github.io/public/img/og-image.png"}),(0,s.jsx)("meta",{name:"twitter:site:domain",content:"oas-tools.github.io"}),(0,s.jsx)("meta",{name:"twitter:url",content:"https://oas-tools.github.io"}),(0,s.jsx)("meta",{name:"og:title",content:"OAS Tools: A NodeJS OpenAPI framework"}),(0,s.jsx)("meta",{name:"og:image",content:"https://oas-tools.github.io/public/img/og-image.png"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-title",content:"OAS Tools"}),(0,s.jsx)("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/apple-icon-180x180.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"192x192",href:"/android-icon-192x192.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/favicon-32x32.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"96x96",href:"/favicon-96x96.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/favicon-16x16.png"}),(0,s.jsx)("meta",{name:"msapplication-TileImage",content:"/ms-icon-144x144.png"})]})}},1722:function(e,t,n){"use strict";n.r(t);var s=n(6042),i=n(9396),o=n(5893),r=n(6147),a=n(7308),l=n(7845),c=n(1151),d=(n(5675),n(8756)),h=n(3952),p=[{name:"blog",children:[{name:"articles",children:[{name:"announcingv3",route:"/blog/articles/announcingv3",frontMatter:{image:"oastools3.png",description:"The new OAS Tools version has been finally released. Take a look to all the new features included in OAS Tools v3.0!",date:"2021-08-14T00:00:00.000Z"}},{name:"meta.json",meta:{announcingv3:"OAS Tools v3 is out!"}}],route:"/blog/articles"},{name:"index",route:"/blog",frontMatter:{title:"Blog",searchable:!1}},{name:"meta.json",meta:{index:{type:"page",theme:{sidebar:!1}},articles:{type:"page",theme:{sidebar:!1}}}}],route:"/blog"},{name:"docs",children:[{name:"cli",route:"/docs/cli",frontMatter:{title:"CLI"}},{name:"compatibility",route:"/docs/compatibility",frontMatter:{title:"Compatibility"}},{name:"customization",children:[{name:"custom-loger",route:"/docs/customization/custom-loger",frontMatter:{title:"Custom logger"}},{name:"external-modules",route:"/docs/customization/external-modules",frontMatter:{title:"External Modules"}},{name:"meta.json",meta:{"project-setup":"Advanced project Setup","custom-loger":"Adding a custom logger","external-modules":"External modules"}},{name:"project-setup",route:"/docs/customization/project-setup",frontMatter:{title:"Project Setup"}}],route:"/docs/customization"},{name:"features",children:[{name:"error-handling",route:"/docs/features/error-handling",frontMatter:{title:"Errors"}},{name:"meta.json",meta:{swaggerUI:"Swagger UI",validation:"Validation",routing:"Routing",security:"Security","error-handling":"Handling errors"}},{name:"routing",route:"/docs/features/routing",frontMatter:{title:"Routing"}},{name:"security",route:"/docs/features/security",frontMatter:{title:"Security"}},{name:"swaggerUI",route:"/docs/features/swaggerUI",frontMatter:{title:"SwaggerUI"}},{name:"validation",route:"/docs/features/validation",frontMatter:{title:"Validation"}}],route:"/docs/features"},{name:"fundamentals",children:[{name:"business-logic",route:"/docs/fundamentals/business-logic",frontMatter:{title:"Bussiness logic"}},{name:"config",route:"/docs/fundamentals/config",frontMatter:{title:"Configuration"}},{name:"meta.json",meta:{openapifile:"OpenAPI file",config:"Configuration","business-logic":"Business logic"}},{name:"openapifile",route:"/docs/fundamentals/openapifile",frontMatter:{title:"OpenAPI file"}}],route:"/docs/fundamentals"},{name:"getting-started",children:[{name:"meta.json",meta:{overview:"Overview",quickstart:"Quickstart"}},{name:"overview",route:"/docs/getting-started/overview",frontMatter:{title:"Overview"}},{name:"quickstart",route:"/docs/getting-started/quickstart",frontMatter:{title:"Quickstart"}}],route:"/docs/getting-started"},{name:"meta.json",meta:{"getting-started":"Getting Started",fundamentals:"Fundamentals",features:"Features",cli:"CLI",customization:"Customization",migration:"Migration Guide",compatibility:"Compatibility"}},{name:"migration",route:"/docs/migration",frontMatter:{title:"Migration"}}],route:"/docs"},{name:"meta.json",meta:{docs:{title:"Docs",type:"page"},blog:{title:"Blog",type:"page"}}}];globalThis.__nextra_internal__={pageMap:p,route:"/docs/features/validation"};var u=(0,a.withSSG)((0,r.Z)({filename:"validation.mdx",route:"/docs/features/validation",meta:{title:"Validation"},pageMap:p,titleText:"Validation",headings:[{type:"heading",depth:1,children:[{type:"text",value:"Validation",position:{start:{line:5,column:3,offset:108},end:{line:5,column:13,offset:118}}}],position:{start:{line:5,column:1,offset:106},end:{line:5,column:13,offset:118}},value:"Validation"},{type:"heading",depth:2,children:[{type:"text",value:"OpenAPI file validation",position:{start:{line:10,column:4,offset:535},end:{line:10,column:27,offset:558}}}],position:{start:{line:10,column:1,offset:532},end:{line:10,column:27,offset:558}},value:"OpenAPI file validation"},{type:"heading",depth:2,children:[{type:"text",value:"Request validation",position:{start:{line:23,column:4,offset:1611},end:{line:23,column:22,offset:1629}}}],position:{start:{line:23,column:1,offset:1608},end:{line:23,column:22,offset:1629}},value:"Request validation"},{type:"heading",depth:3,children:[{type:"text",value:"Parameters",position:{start:{line:26,column:5,offset:1879},end:{line:26,column:15,offset:1889}}}],position:{start:{line:26,column:1,offset:1875},end:{line:26,column:15,offset:1889}},value:"Parameters"},{type:"heading",depth:3,children:[{type:"text",value:"Request body",position:{start:{line:52,column:5,offset:2882},end:{line:52,column:17,offset:2894}}}],position:{start:{line:52,column:1,offset:2878},end:{line:52,column:17,offset:2894}},value:"Request body"},{type:"heading",depth:2,children:[{type:"text",value:"Response validation",position:{start:{line:68,column:4,offset:3544},end:{line:68,column:23,offset:3563}}}],position:{start:{line:68,column:1,offset:3541},end:{line:68,column:23,offset:3563}},value:"Response validation"},{type:"heading",depth:3,children:[{type:"text",value:"Intercepting responses",position:{start:{line:85,column:5,offset:4408},end:{line:85,column:27,offset:4430}}}],position:{start:{line:85,column:1,offset:4404},end:{line:85,column:27,offset:4430}},value:"Intercepting responses"},{type:"heading",depth:3,children:[{type:"text",value:"Validating content",position:{start:{line:99,column:5,offset:5093},end:{line:99,column:23,offset:5111}}}],position:{start:{line:99,column:1,offset:5089},end:{line:99,column:23,offset:5111}},value:"Validating content"}],hasH1:!0},l.Z));function m(e){var t=Object.assign({h1:"h1",p:"p",a:"a",code:"code",h2:"h2",pre:"pre",h3:"h3",div:"div",span:"span",blockquote:"blockquote",em:"em"},(0,c.ah)(),e.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{children:"Validation"}),"\n",(0,o.jsx)(h.Z,{type:"info",emoji:"\u24d8",children:(0,o.jsxs)(t.p,{children:["The errors thrown by validator middleware explained in the ",(0,o.jsx)(t.a,{href:"#request-validation",children:"Request Validation"})," and ",(0,o.jsx)(t.a,{href:"#response-validation",children:"Response Validation"})," sections in this page are handled by the ",(0,o.jsx)(t.a,{href:"../features/error-handling",children:"built-in error handler"})," and therefore the status code that the server sets for the responses when validation is ",(0,o.jsx)(t.code,{children:"strict"})," depends on it being enabled."]})}),"\n",(0,o.jsx)(t.h2,{id:"openapi-file-validation",children:"OpenAPI file validation"}),"\n",(0,o.jsxs)(t.p,{children:["OAS Tools is capable to validate an OpenAPI document thanks through the ",(0,o.jsx)(t.a,{href:"https://github.com/oas-tools/oas-commons",children:"Commons library"}),". OAS Tools' commons integrates ",(0,o.jsx)(t.a,{href:"https://ajv.js.org/",children:"AJV"})," JSON Schema validator, wrapped in two functions that validates the whole document or a part of it."]}),"\n",(0,o.jsx)(t.p,{children:"Being the validator integrated in Commons, it is reusable and can be called from different middlewares and tools, such as the CLI or the request and response validator middlewares."}),"\n",(0,o.jsx)(t.p,{children:"OAS Tools perform a validation of the complete OpenAPI document upon initialization in order to avoid errors caused by the document not being valid towards the correspondent version of the OpenAPI schema. In case the file is not valid, AJV validations error are pretty printed through the built-in logger."}),"\n",(0,o.jsxs)(t.p,{children:["This would be the output when missing the required property 'title' inside ",(0,o.jsx)(t.code,{children:"info"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"2022-08-13 12:08:74 [oas-tools] ERROR: ValidationError: Specification file does not meet OpenAPI 3.0.0 schema.\n- Validation failed at /info > must have required property 'title'\n"})}),"\n",(0,o.jsx)(t.h2,{id:"request-validation",children:"Request validation"}),"\n",(0,o.jsx)(t.p,{children:"The request validation is a middleware function that relies on the common's library validation functions to check specific parts of the OpenAPI document, more precissely, it checks parameters andrequest body against OpenAPI schema declaration."}),"\n",(0,o.jsx)(t.h3,{id:"parameters",children:"Parameters"}),"\n",(0,o.jsx)(t.p,{children:"The parameters are validated for each request depending on what has been specified for that operation:"}),"\n",(0,o.jsx)(t.div,{"data-rehype-pretty-code-fragment":"","data-nextra-code":"",children:(0,o.jsx)(t.pre,{children:(0,o.jsxs)(t.code,{"data-language":"yaml","data-theme":"default",children:[(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"..."})}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"/endpoint/{id}"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"get"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"params"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"parameters"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"      - "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"name"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:"id"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:"path"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"required"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"true"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"schema"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:"integer"})]}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"..."})})]})})}),"\n",(0,o.jsxs)(t.p,{children:["In the snippet above we have defined a GET request that gets one required parameter named ",(0,o.jsx)(t.code,{children:"id"}),". If we made a GET request to ",(0,o.jsx)(t.code,{children:"{server-url}/endpoint"})," we would get a warning on console (or an error message if ",(0,o.jsx)(t.code,{children:"strict"})," validation has been toggled on in configuration) telling that there has been a validation error due to the parameter ",(0,o.jsx)(t.code,{children:"id"})," being required. The same would happen if we specified a non-integer id, since it is specified to be such type."]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["Strict validation causes the server to respond ",(0,o.jsx)(t.code,{children:"400 Bad Request"})," when request validation fails."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"2022-08-13 12:08:64 [oas-tools] WARN: Parameter id does not match the schema specified in the OAS Document:\n- Validation failed at #/type > must be integer\n"})}),"\n",(0,o.jsx)(t.h3,{id:"request-body",children:"Request body"}),"\n",(0,o.jsx)(t.p,{children:"Similarly to how parameters validatio works, the request body is validated through the commons library validation functions."}),"\n",(0,o.jsx)(t.div,{"data-rehype-pretty-code-fragment":"","data-nextra-code":"",children:(0,o.jsx)(t.pre,{children:(0,o.jsxs)(t.code,{"data-language":"yaml","data-theme":"default",children:[(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"..."})}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"post"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"requestBody"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Body of the request"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"required"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"true"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"content"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"application/json"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"schema"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-string-expression)"},children:"object"})]}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"..."})})]})})}),"\n",(0,o.jsxs)(t.p,{children:["In this case, we are defining a post request whith a required content body in which an object must be included formatted as JSON. If we made a POST request without including the body or including non-object content, then the server would print a warning on console or in case ",(0,o.jsx)(t.code,{children:"strict"})," validation is active, respond with ",(0,o.jsx)(t.code,{children:"400 Bad Request"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"response-validation",children:"Response validation"}),"\n",(0,o.jsxs)(t.p,{children:["The response validation middleware is a special function capable of intercepting responses, validate them and then sending them to the client. Even if this function has performs validation after ",(0,o.jsx)(t.code,{children:"res.send()"})," is executed, it must be registered in the middleware chain before ",(0,o.jsx)(t.code,{children:"res.send()"})," is called, that is why it is registered before the router middleware (check out the diagram in the ",(0,o.jsx)(t.a,{href:"./routing",children:"routing section"}),"):"]}),"\n",(0,o.jsx)(d.Z,{id:"2",children:(0,o.jsx)(t.p,{children:"flowchart LR;\nOAS-PARAMS(Parameter \\n Parser)\nOAS-SECURITY(Security \\nMiddleware)\nOAS-RQVALIDATOR(Request \\n Validator)\nOAS-RPVALIDATOR(Response \\n Validator)\nOAS-ROUTER(Router \\n Middleware)\nOAS-PARAMS--\x3eOAS-SECURITY\nOAS-SECURITY--\x3eOAS-RQVALIDATOR\nOAS-RQVALIDATOR--\x3eOAS-RPVALIDATOR\nOAS-RPVALIDATOR--\x3eOAS-ROUTER\nstyle OAS-RPVALIDATOR stroke-width:3px"})}),"\n",(0,o.jsx)(t.h3,{id:"intercepting-responses",children:"Intercepting responses"}),"\n",(0,o.jsxs)(t.p,{children:["As explained above, the response validator is registered before the router middleware that calls ",(0,o.jsx)(t.code,{children:"res.sen()"})," through controllers. However, this middleware is an ",(0,o.jsx)(t.em,{children:"interceptor"}),", meaning it must read the responses sent to client, validate the content and send a new response to the client (or the same if it is valid)."]}),"\n",(0,o.jsxs)(t.p,{children:["In order for this middleware to intercept responses, the ",(0,o.jsx)(t.code,{children:"res.send()"})," function is overriden in a way that the validations are performed in the first place, and then the original send function is called:"]}),"\n",(0,o.jsx)(t.div,{"data-rehype-pretty-code-fragment":"","data-nextra-code":"",children:(0,o.jsx)(t.pre,{children:(0,o.jsxs)(t.code,{"data-language":"js","data-theme":"default",children:[(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"oldSend"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"res"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:".send;"})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"res"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:"send"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" (response) "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" {   "})]}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-comment)"},children:"/* response validation */"})]}),"\n",(0,o.jsx)(t.span,{className:"line"}),"\n",(0,o.jsxs)(t.span,{className:"line",children:[(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-constant)"},children:"oldSend"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-function)"},children:".call"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"(res"}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:" newResponse);"})]}),"\n",(0,o.jsx)(t.span,{className:"line",children:(0,o.jsx)(t.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})})}),"\n",(0,o.jsx)(t.h3,{id:"validating-content",children:"Validating content"}),"\n",(0,o.jsxs)(t.p,{children:["In case of the response content, not only it is necessary to validate the content itself against the schema, but also check that the ",(0,o.jsx)(t.code,{children:"content-type"})," matches the ",(0,o.jsx)(t.code,{children:"Accept"})," header set in requests."]}),"\n",(0,o.jsxs)(t.p,{children:["The response content is validated just like the request body before. Its declaration must exist under the ",(0,o.jsx)(t.code,{children:"responses"})," field of each operation specified in the OpenAPI document. Then the middleware will check the data against the schema before it is sent to the client, and print a warning or error message (when ",(0,o.jsx)(t.code,{children:"strict"})," is active) in case the content is not valid."]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["If ",(0,o.jsx)(t.code,{children:"strict"})," is active and the server throws a response validation error due to invalid content, it will respond with a ",(0,o.jsx)(t.code,{children:"500 Internal server error"})," since the responses are set in the server controllers and therefore, it is a server error."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The middleware will also check the response ",(0,o.jsx)(t.code,{children:"content-type"})," MIMEType against the ",(0,o.jsx)(t.code,{children:"Accept"})," header set in request, that way if the response ",(0,o.jsx)(t.code,{children:"content-type"})," is not accepted and validation is set to ",(0,o.jsx)(t.code,{children:"strict"}),", the server will respond with ",(0,o.jsx)(t.code,{children:"406 Not Accepted"}),", else it will print a warn message. In case no ",(0,o.jsx)(t.code,{children:"Accept"})," header is provided in the request, then the server will assume ",(0,o.jsx)(t.code,{children:"*/*"})," as any content type is valid as a response for that request."]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["If no content-type is set for response, OAS Tools will assume it is ",(0,o.jsx)(t.code,{children:"application/json;charset=utf-8"}),"."]}),"\n"]})]})}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},(0,c.ah)(),e.components),n=t.wrapper;return n?(0,o.jsx)(n,(0,i.Z)((0,s.Z)({},e),{children:(0,o.jsx)(m,(0,s.Z)({},e))})):m(e)}function f(e){return(0,o.jsx)(u,(0,i.Z)((0,s.Z)({},e),{children:(0,o.jsx)(x,{})}))}f.getLayout=u.getLayout,t.default=f},7663:function(e){!function(){var t={308:function(e){var t,n,s=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"===typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var a,l=[],c=!1,d=-1;function h(){c&&a&&(c=!1,a.length?l=a.concat(l):d=-1,l.length&&p())}function p(){if(!c){var e=r(h);c=!0;for(var t=l.length;t;){for(a=l,l=[];++d<t;)a&&a[d].run();d=-1,t=l.length}a=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function u(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new u(e,t)),1!==l.length||c||r(p)},u.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}},r=!0;try{t[e](o,o.exports,s),r=!1}finally{r&&delete n[e]}return o.exports}s.ab="//";var i=s(308);e.exports=i}()},3952:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var s=n(7294),i={default:"bg-orange-50 border border-orange-100 text-orange-800 dark:text-orange-300 dark:bg-orange-400 dark:border-orange-400 dark:bg-opacity-20 dark:border-opacity-30",error:"bg-red-100 border border-red-200 text-red-900 dark:text-red-200 dark:bg-red-900 dark:bg-opacity-30 dark:border-opacity-30",info:"bg-blue-100 border border-blue-200 text-blue-900 dark:text-blue-200 dark:bg-blue-900 dark:bg-opacity-30 dark:border-opacity-30",warning:"bg-yellow-50 border border-yellow-100 text-yellow-900 dark:text-yellow-200 dark:bg-yellow-700 dark:bg-opacity-30"},o=({children:e,type:t="default",emoji:n="\ud83d\udca1"})=>s.createElement("div",{className:`${i[t]} flex rounded-lg nextra-callout mt-6`},s.createElement("div",{className:"pl-3 pr-2 py-2 select-none text-xl",style:{fontFamily:'"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'}},n),s.createElement("div",{className:"pr-4 py-2"},e))}},function(e){e.O(0,[578,873,892,774,888,179],(function(){return t=183,e(e.s=t);var t}));var t=e.O();_N_E=t}]);